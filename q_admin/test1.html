<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>공지사항</title>
    <!-- 부트스트랩 CSS 로드 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@100..900&display=swap" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <style>
.navbar {
    position: relative;
    width: 100%;
    z-index: 1001;
    padding: 30px 0;
    background-color: #fff;
    display: flex;
    justify-content: center;
}

.navbar-custom {
    padding-right: 50px;
    padding-left: 50px;
}

.navbar-nav {
    margin-left: auto;
}

.navbar-brand img {
    height: 100px;
    margin-right: 10px;
}

.navbar-nav .nav-link {
    color: black;
    font-size: 1.5rem;
    font-family: 'Noto Sans KR', sans-serif;
    transition: color 0.3s;
    margin: 0 7px; /* 글씨 간격 추가 */
}

.navbar-nav .nav-link:hover {
    color: #ffc107 !important;
}

.navbar-brand .text-white {
    color: black;
    font-family: 'Noto Sans KR', sans-serif;
    font-size: 1.9rem;
}

.community-menu {
    background-color: white;
    padding: 20px 0;
    border-top: 1px solid #dee2e6;
    border-bottom: 1px solid #dee2e6;
    display: flex;
    align-items: center;
    justify-content: center;
}

.community-page {
    font-size: 1.2rem;
    color: #343a40;
    margin-right: 15px;
}

.community-menu .nav {
    justify-content: center;
}

.community-menu .nav-link {
    font-size: 1.2rem;
    color: #343a40;
    transition: color 0.3s;
}

.community-menu .nav-link:hover {
    color: #ffc107;
}

        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #fff;
        }

        .header {
            background-color: #fff;
            padding: 50px 0;
            text-align: center;
            border-bottom: 1px solid #dee2e6;
            margin-bottom: 80px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: #343a40;
        }

        .header p {
            font-size: 1.2rem;
            color: #6c757d;
        }

        .notice-item {
            padding: 15px 0;
            border-bottom: 1px solid #dee2e6;
        }

        .notice-item-title {
            font-size: 1.25rem;
            color: #007bff;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .notice-item-content {
            display: none;
            padding-top: 10px;
            font-size: 1rem;
            color: #343a40;
        }

        .notice-item.open .notice-item-content {
            display: block;
        }

        .notice-item.open .notice-item-title {
            font-weight: bold;
            color: #000;
        }

        .notice-item .delete-button {
            display: none;
            margin-top: 10px;
            color: #dc3545;
            cursor: pointer;
        }

        .notice-item.open .delete-button {
            display: block;
        }

        footer {
            margin-top: 100px;
            background-color: #f8f9fa;
            color: black;
            padding: 30px;
            text-align: center;
        }
    </style>
</head>
<body>

<!-- 네비게이션 바 -->
<nav class="navbar navbar-expand-lg">
    <div class="container-fluid navbar-custom">
        <a class="navbar-brand" href="#">
            <img src="../image/logo.png" alt="Crime Scene 로고" class="navbar-logo">
            <span class="text-white">Crime Scene</span>
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
            <div class="navbar-nav ms-auto">
                <a class="nav-link active" aria-current="page" href="../main/main.html">Home</a>
                <a class="nav-link" href="../notice/notice.html">소통하기</a>
                <a class="nav-link" href="../mapmain/mapmain.html">지도보기</a>
                <a class="nav-link" href="../chart/chart.html">범죄통계표</a>
                <a class="nav-link" href="../machinlearning/machinlearning.html">범죄예측</a>
            </div>
        </div>
    </div>
</nav>

<!-- 커뮤니티 페이지 선택 -->
<div class="community-menu">
    <div class="container">
        <div class="row align-items-center justify-content-center">
            <div class="col-auto">
                <span class="community-page"><i class="fas fa-home"></i> community</span>
            </div>
            <div class="col-auto">
                <nav class="nav justify-content-center">
                    <a class="nav-link" href="../board/board.html">의견 게시판</a>
                    <a class="nav-link" href="../notice/notice.html">공지사항</a>
                    <a class="nav-link" href="../question/question.html">설문조사</a>
                    <a class="nav-link" href="../search/search.html">경찰서 찾기</a>
                </nav>
            </div>
        </div>
    </div>
</div>

<!-- 공지사항 페이지 -->
<header class="header">
    <div class="container-h">
        <h1>공지사항</h1>
        <p>좀 더 편리하게 사용하시도록 도움 드릴게요</p>
    </div>
</header>

<!-- 공지사항 목록 -->
<div class="container" id="notice-list">
</div>

<!-- 글쓰기 버튼 추가 -->
<div class="container text-center my-4">
    <button class="btn btn-primary" id="writeButton">글쓰기</button>
</div>

<!-- 푸터 -->
<footer>
    <p>경기도 용인시 처인구 용인대학로 134 | 민원전화 010-1234-5678</p>
    <p>© 2024 Crime Scene. All rights reserved.</p>
    <p>본 사이트는 졸업작품을 위해 임시적으로 개발된 사이트임을 알립니다.</p>
</footer>

<!-- 비밀번호 입력 모달 -->
<div class="modal fade" id="passwordModal" tabindex="-1" aria-labelledby="passwordModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="passwordModalLabel">비밀번호 입력</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <input type="password" class="form-control" id="passwordInput" placeholder="비밀번호를 입력하세요">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">취소</button>
                <button type="button" class="btn btn-primary" id="passwordSubmitButton">확인</button>
            </div>
        </div>
    </div>
</div>

<!-- 삭제 비밀번호 입력 모달 -->
<div class="modal fade" id="deletePasswordModal" tabindex="-1" aria-labelledby="deletePasswordModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deletePasswordModalLabel">비밀번호 입력</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <input type="password" class="form-control" id="deletePasswordInput" placeholder="비밀번호를 입력하세요">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">취소</button>
                <button type="button" class="btn btn-primary" id="deletePasswordSubmitButton">확인</button>
            </div>
        </div>
    </div>
</div>

<!-- Firebase SDK 로드 -->
<script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-storage-compat.js"></script> <!-- Firebase Storage SDK 추가 -->

<script>
    // Firebase 초기화
    const firebaseConfig = {
        apiKey: "AIzaSyD7g5DdSIGP7FB5Jjsejqjwd71HKjZK0XI",
        authDomain: "crime-scene-9a5f5.firebaseapp.com",
        projectId: "crime-scene-9a5f5",
        storageBucket: "crime-scene-9a5f5.appspot.com",
        messagingSenderId: "1056014636450",
        appId: "1:1056014636450:web:3ca8a4560bf0c135a7cefb"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);

    // Initialize Firestore
    const db = firebase.firestore();

    // Fetch documents from 'notice' collection
    db.collection('notice').get().then((querySnapshot) => {
        querySnapshot.forEach((doc) => {
            const data = doc.data();
            const noticeItem = `<div class="notice-item" data-id="${doc.id}">
                <div class="notice-item-title">
                    ${data.제목}
                    <i class="fas fa-plus"></i>
                </div>
                <div class="notice-item-content">
                    ${data.내용}
                    <button class="delete-button">삭제</button>
                </div>
            </div>`;
            document.getElementById('notice-list').innerHTML += noticeItem;
        });

        // 이벤트 리스너 추가 (동적으로 추가된 요소에도 적용)
        document.querySelectorAll('.notice-item-title').forEach(item => {
            item.addEventListener('click', () => {
                const noticeItem = item.parentElement;
                const icon = item.querySelector('i');
                noticeItem.classList.toggle('open');
                if (noticeItem.classList.contains('open')) {
                    icon.classList.remove('fa-plus');
                    icon.classList.add('fa-minus');
                } else {
                    icon.classList.remove('fa-minus');
                    icon.classList.add('fa-plus');
                }
            });
        });

        // 삭제 버튼 이벤트 리스너 추가
        document.querySelectorAll('.delete-button').forEach(button => {
            button.addEventListener('click', (event) => {
                const noticeId = event.target.parentElement.parentElement.getAttribute('data-id');
                const deletePasswordModal = new bootstrap.Modal(document.getElementById('deletePasswordModal'));
                document.getElementById('deletePasswordSubmitButton').onclick = async () => {
                    const inputPassword = document.getElementById('deletePasswordInput').value;
                    const passwordDocRef = db.collection('passwd').doc('board');

                    try {
                        const doc = await passwordDocRef.get();
                        if (doc.exists) {
                            const passwordData = doc.data();
                            if (inputPassword === passwordData.admin1) {
                                await db.collection('notice').doc(noticeId).delete();
                                alert('공지사항이 삭제되었습니다.');
                                location.reload(); // 페이지 새로 고침
                            } else {
                                alert('비밀번호가 맞지 않습니다.');
                            }
                        } else {
                            alert('비밀번호 설정이 잘못되었습니다.');
                        }
                    } catch (error) {
                        console.error("Error checking password: ", error);
                    }
                    deletePasswordModal.hide();
                };
                deletePasswordModal.show();
            });
        });
    }).catch((error) => {
        console.error("Error fetching documents: ", error);
    });

    // 비밀번호 확인 기능
    document.getElementById('writeButton').addEventListener('click', () => {
        const passwordModal = new bootstrap.Modal(document.getElementById('passwordModal'));
        passwordModal.show();
    });

    document.getElementById('passwordSubmitButton').addEventListener('click', async () => {
        const inputPassword = document.getElementById('passwordInput').value;
        const passwordDocRef = db.collection('passwd').doc('board');

        try {
            const doc = await passwordDocRef.get();
            if (doc.exists) {
                const passwordData = doc.data();
                if (inputPassword === passwordData.admin1) {
                    window.location.href = '../admin/notice_admin.html'; // 비밀번호가 맞으면 관리자 페이지로 이동
                } else {
                    alert('비밀번호가 맞지 않습니다.');
                }
            } else {
                alert('비밀번호 설정이 잘못되었습니다.');
            }
        } catch (error) {
            console.error("Error checking password: ", error);
        }
    });
</script>

<!-- 제이쿼리 로드 -->
<script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>

<!-- 부트스트랩 JS 로드 -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

</body>
</html>
